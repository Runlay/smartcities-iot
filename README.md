# Smart Cities and Internet of Things Project : SmartStore – Smart Warehouse IoT System (Group 08)

Smart Cities and Internet of Things Project Summer Term 2025, Group 08

Students:

- Lucas Etteldorf (3756762)
- Max Finkenbeiner (3757486)
- Finn Romaneesen (3757486)

## Components

### Gateway

- common interface for physical devices
- reads raw sensor data
- sends JSON messages with sensor data
- receives JSON messages with actuator commands
- triggers actual actuator actions

### Messaging

- RabbitMQ publish-subscribe messaging using MQTT
- different topics for:
  - each sensor
  - each actuator (for receiving commands and for sending updated state)
  - receiving generated problem instances and sending plans

### Context and Problem Generation

- receives messages with numerical sensor values
- transforms them into a more abstract environment representation (discrete classes) to be compatible with level 1 PDDL
- uses the context to dynamically generate a new problem instance every time the state changes
- we concsiously chose to combine context and problem generation into one component since they are tightly coupled and separating them would just cause more overhead (another topic with even more messages being sent, etc.)

### AI Planner

- receives generated problem instances
- using the current problem and the domain description, computes a plan
- sends the plan to the orchestration component

### Orchestration

- receives the current plan generated by the planner
- parses the plan into a list of actions
- sends one message for each actuator action to execute to the gateway, which can then actually execute these actions

### Backend

- receives sensor values and stores them in a Redis key-value store
- also receives the current environment configuration and stores it in a Postgres database
- just an interface from receives messages to connecting to databases

### Redis Key-Value Store

- stores all raw sensor readings
- still efficient with streaming data/frequent readings

### Postgres Database

- stores environment configuration
- suitable since the configuration isn't a continous stream of data like the sensor readings

### Simulated Devices

- simulates the temperature and humidity sensors and AC and ventilation actuators
- temperature and humidity values are sampled from the currently configured range at first
- then, they slowly rise over time up to some threshold
- the planner will then generate a plan with actions to turn the corresponding actuators on (AC to decrease temperature and ventilation to decrease humidity)
- the values will then decrease back down into the range
- the planner will then generate a plan to turn the actuators back off

### Frontend

- displays:
  - current environment state (all sensor values and actuator states)
  - current system configuration (which can also be changed)
  - latest plan
  - raw sensor values

## Messaging Architecture

### MQTT Topic Structure

- sensor/
  - temperature
  - humidity
  - motion
  - pressure
- actuator/
  - ac/
    - command
    - state
  - ventilation/
    - command
    - state
  - light/
    - command
    - state
  - alarm/
    - command
    - state
- planner/
  - plan
  - problem

### JSON Message Formats

#### `sensor/<sensorType>`

```json
{
  "type": <string>,
  "value": <string>,
  "unit": <string>,
  "timestamp": <string (ISO 8601)>
}
```

**Temperature**:

```json
{
  "type": "temperature",
  "value": "22.41",
  "unit": "°C",
  "timestamp": "2025-07-11T14:08:52+02:00"
}
```

**Humidity**:

```json
{
  "type": "humidity",
  "value": "45.32",
  "unit": "%",
  "timestamp": "2025-07-11T14:08:52+02:00"
}
```

**Motion**:

```json
{
  "type": "motion",
  "value": "1", // 1 = motion detected, 0 = no motion detected
  "unit": "", // no unit needed
  "timestamp": "2025-07-11T14:08:52+02:00"
}
```

**Pressure**:

```json
{
  "type": "pressure",
  "value": "0", // 1 = pressure detected (above threshold), 0 = no pressure detected (below threshold)
  "unit": "", // no unit needed
  "timestamp": "2025-07-11T14:08:52+02:00"
}
```

#### `actuator/<actuatorType>/command`

```json
{
  "command": <string>, // "ON" or "OFF"
  "timestamp": <string (ISO 8601)>
}
```

#### `actuator/<actuatorType>/state`

```json
{
  "state": <string>, // "ON" or "OFF"
  "timestamp": <string (ISO 8601)>
}
```

**Actuator types**:

- "ac"
- "ventilation"
- "light"
- "alarm"

#### `planner/problem`

```json
{
  "id": <string>,
  "content": <string>, // raw content of "problem.pddl" as string
  "timestamp": <string (ISO 8601)>
}
```

#### `planner/plan`

```json
{
  "id": <string>,
  "steps": [
    "actuator": <string>,
    "action": <string>,
    "timestamp": <string (ISO 8601)>
  ],
  "createdAt": <string (ISO 8601)>
}
```
